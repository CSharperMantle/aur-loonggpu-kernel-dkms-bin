From 73ba877995d2c08941a7f4fd91cab5a4369c2a0d Mon Sep 17 00:00:00 2001
From: Xi Ruoyao <xry111@xry111.site>
Date: Thu, 4 Dec 2025 18:31:07 +0800
Subject: [PATCH 21/63] loonggpu-bridge: constify struct drm_display_mode
 pointers

Prepare for 6.15 kernel API change.

Signed-off-by: Xi Ruoyao <xry111@xry111.site>
---
 loonggpu-bridge/bridge_phy.c   | 2 +-
 loonggpu-bridge/bridge_phy.h   | 3 ++-
 loonggpu-bridge/ls2k2000_drv.c | 2 +-
 loonggpu-bridge/ls2k3000_drv.c | 2 +-
 loonggpu-bridge/ls7a1000_drv.c | 2 +-
 loonggpu-bridge/ls7a2000_drv.c | 2 +-
 loonggpu-bridge/lt6711_drv.c   | 2 +-
 loonggpu-bridge/lt8718_drv.c   | 2 +-
 8 files changed, 9 insertions(+), 8 deletions(-)

diff --git a/loonggpu-bridge/bridge_phy.c b/loonggpu-bridge/bridge_phy.c
index cd9b120..c83f234 100644
--- a/loonggpu-bridge/bridge_phy.c
+++ b/loonggpu-bridge/bridge_phy.c
@@ -99,7 +99,7 @@ static int bridge_phy_connector_get_modes(struct drm_connector *connector)
 	return count;
 }
 
-static bool is_resolution_valid(struct panel_resource *panel_resource, struct drm_display_mode *mode)
+static bool is_resolution_valid(struct panel_resource *panel_resource, const struct drm_display_mode *mode)
 {
 	u32 vrefresh = 0;
 	u32 index;
diff --git a/loonggpu-bridge/bridge_phy.h b/loonggpu-bridge/bridge_phy.h
index 44edebe..42f36e6 100644
--- a/loonggpu-bridge/bridge_phy.h
+++ b/loonggpu-bridge/bridge_phy.h
@@ -7,6 +7,7 @@
 #include <linux/pwm.h>
 #include <linux/regmap.h>
 #include <linux/hdmi.h>
+#include <linux/version.h>
 #include <drm/drm_edid.h>
 #include <drm/drm_bridge.h>
 #include <drm/drm_connector.h>
@@ -165,7 +166,7 @@ struct bridge_phy_cfg_funcs {
 			     const struct drm_display_mode *mode,
 			     const struct drm_display_mode *adj_mode);
 	enum drm_mode_status (*mode_valid)(struct drm_connector *connector,
-					   struct drm_display_mode *mode);
+					   const struct drm_display_mode *mode);
 };
 
 struct bridge_phy_misc_funcs {
diff --git a/loonggpu-bridge/ls2k2000_drv.c b/loonggpu-bridge/ls2k2000_drv.c
index a24747d..aea6bbb 100644
--- a/loonggpu-bridge/ls2k2000_drv.c
+++ b/loonggpu-bridge/ls2k2000_drv.c
@@ -94,7 +94,7 @@ static struct bridge_phy_hpd_funcs ls2k2000_hpd_funcs = {
 };
 
 static enum drm_mode_status ls2k2000_mode_valid(struct drm_connector *connector,
-					      struct drm_display_mode *mode)
+					        const struct drm_display_mode *mode)
 {
 	if ((mode->hdisplay > 1920 && connector->index == 1) ||
 			mode->hdisplay > 4096 ||
diff --git a/loonggpu-bridge/ls2k3000_drv.c b/loonggpu-bridge/ls2k3000_drv.c
index 9f42288..9484972 100644
--- a/loonggpu-bridge/ls2k3000_drv.c
+++ b/loonggpu-bridge/ls2k3000_drv.c
@@ -108,7 +108,7 @@ static struct bridge_phy_hpd_funcs ls2k3000_hpd_funcs = {
 };
 
 static enum drm_mode_status ls2k3000_mode_valid(struct drm_connector *connector,
-					      struct drm_display_mode *mode)
+					        const struct drm_display_mode *mode)
 {
 	if (mode->hdisplay > 4096 ||
 	    mode->vdisplay > 2160 ||
diff --git a/loonggpu-bridge/ls7a1000_drv.c b/loonggpu-bridge/ls7a1000_drv.c
index e2f1946..574c3a2 100644
--- a/loonggpu-bridge/ls7a1000_drv.c
+++ b/loonggpu-bridge/ls7a1000_drv.c
@@ -93,7 +93,7 @@ static struct bridge_phy_hpd_funcs ls7a1000_hpd_funcs = {
 };
 
 static enum drm_mode_status ls7a1000_mode_valid(struct drm_connector *connector,
-					      struct drm_display_mode *mode)
+					        const struct drm_display_mode *mode)
 {
 	if (mode->hdisplay > 2048 ||
 			mode->hdisplay == 1680 ||
diff --git a/loonggpu-bridge/ls7a2000_drv.c b/loonggpu-bridge/ls7a2000_drv.c
index 283e566..044f6da 100644
--- a/loonggpu-bridge/ls7a2000_drv.c
+++ b/loonggpu-bridge/ls7a2000_drv.c
@@ -100,7 +100,7 @@ static struct bridge_phy_hpd_funcs ls7a2000_hpd_funcs = {
 };
 
 static enum drm_mode_status ls7a2000_mode_valid(struct drm_connector *connector,
-					      struct drm_display_mode *mode)
+					        const struct drm_display_mode *mode)
 {
 	if (mode->hdisplay > 4096 ||
 			mode->hdisplay == 1680 ||
diff --git a/loonggpu-bridge/lt6711_drv.c b/loonggpu-bridge/lt6711_drv.c
index 2573ca4..52636fa 100644
--- a/loonggpu-bridge/lt6711_drv.c
+++ b/loonggpu-bridge/lt6711_drv.c
@@ -5,7 +5,7 @@
 #include "bridge_phy.h"
 
 static enum drm_mode_status lt6711_mode_valid(struct drm_connector *connector,
-					      struct drm_display_mode *mode)
+					      const struct drm_display_mode *mode)
 {
 	if (mode->hdisplay < 1920)
 		return MODE_BAD;
diff --git a/loonggpu-bridge/lt8718_drv.c b/loonggpu-bridge/lt8718_drv.c
index f958554..677e782 100644
--- a/loonggpu-bridge/lt8718_drv.c
+++ b/loonggpu-bridge/lt8718_drv.c
@@ -624,7 +624,7 @@ static int lt8718_video_output(struct loonggpu_bridge_phy *phy)
 }
 
 static enum drm_mode_status lt8718_mode_valid(struct drm_connector *connector,
-					      struct drm_display_mode *mode)
+					      const struct drm_display_mode *mode)
 {
         if (mode->hdisplay == 1680 && mode->vdisplay == 1050)
             return MODE_BAD;
-- 
2.52.0

