From f199268c63ea3a06af2f2f954dcc479324d77fed Mon Sep 17 00:00:00 2001
From: Xi Ruoyao <xry111@xry111.site>
Date: Fri, 5 Dec 2025 09:19:11 +0800
Subject: [PATCH 40/63] loonggpu-bridge: alloc bridge phy using
 devm_drm_bridge_alloc

It's mandatory since Linux 6.17.

Link: https://git.kernel.org/torvalds/c/b3f13e00a8de
Signed-off-by: Xi Ruoyao <xry111@xry111.site>
---
 loonggpu-bridge/bridge_phy.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/loonggpu-bridge/bridge_phy.c b/loonggpu-bridge/bridge_phy.c
index 14215c2..74fe48f 100644
--- a/loonggpu-bridge/bridge_phy.c
+++ b/loonggpu-bridge/bridge_phy.c
@@ -759,10 +759,12 @@ struct loonggpu_bridge_phy *bridge_phy_alloc(struct loonggpu_dc_bridge *dc_bridg
 	struct connector_resource *connector_res =
 			dc_bridge->adev->dc->link_info[index].connector;
 
-	bridge_phy = kzalloc(sizeof(*bridge_phy), GFP_KERNEL);
+	bridge_phy = devm_drm_bridge_alloc(dc_bridge->adev->dev,
+					   struct loonggpu_bridge_phy,
+					   bridge, &bridge_funcs);
 	if (IS_ERR(bridge_phy)) {
 		DRM_ERROR("Failed to alloc loonggpu bridge phy!\n");
-		return NULL;
+		return bridge_phy;
 	}
 
 	bridge_phy->display_pipe_index = dc_bridge->display_pipe_index;
-- 
2.52.0

