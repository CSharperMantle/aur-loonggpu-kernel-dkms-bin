From 22de20a43b2ce0a7fd17aa5dd9c5b80f4a734b6a Mon Sep 17 00:00:00 2001
From: Xi Ruoyao <xry111@xry111.site>
Date: Thu, 11 Dec 2025 09:49:49 +0800
Subject: [PATCH 60/63] loonggpu: use ttm_resource_manager_cleanup instead of
 manually inlining it

It should work since Linux 5.9.  And inlining an outdated copy causes a
build failure on Linux 6.19.

Signed-off-by: Xi Ruoyao <xry111@xry111.site>
---
 loonggpu/loonggpu_ttm.c | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/loonggpu/loonggpu_ttm.c b/loonggpu/loonggpu_ttm.c
index 2fd79b0..050fd08 100644
--- a/loonggpu/loonggpu_ttm.c
+++ b/loonggpu/loonggpu_ttm.c
@@ -1875,8 +1875,7 @@ void loonggpu_ttm_set_buffer_funcs_status(struct loonggpu_device *adev, bool ena
 		}
 	} else {
 		drm_sched_entity_destroy(&adev->mman.entity);
-		dma_fence_put(man->move);
-		man->move = NULL;
+		ttm_resource_manager_cleanup(man);
 	}
 
 	/* this just adjusts TTM size idea, which sets lpfn to the correct value */
-- 
2.52.0

