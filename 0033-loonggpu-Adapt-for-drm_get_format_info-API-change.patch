From dbed12e7abc816c974220a4ebf9a337eb32d99fc Mon Sep 17 00:00:00 2001
From: Xi Ruoyao <xry111@xry111.site>
Date: Fri, 15 Aug 2025 20:06:53 +0800
Subject: [PATCH 33/63] loonggpu: Adapt for drm_get_format_info() API change

Link: https://git.kernel.org/torvalds/c/0e7d5874fb6b
Signed-off-by: Xi Ruoyao <xry111@xry111.site>
---
 loonggpu/loonggpu_fb.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/loonggpu/loonggpu_fb.c b/loonggpu/loonggpu_fb.c
index 2990fbe..96a9aca 100644
--- a/loonggpu/loonggpu_fb.c
+++ b/loonggpu/loonggpu_fb.c
@@ -122,7 +122,12 @@ static int loonggpufb_create_pinned_object(struct drm_fb_helper *fb_helper,
 	int height = mode_cmd->height;
 	u32 cpp;
 
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(6, 17, 0)
+	info = drm_get_format_info(adev->ddev, mode_cmd->pixel_format,
+				   mode_cmd->modifier[0]);
+#else
 	info = drm_get_format_info(adev->ddev, mode_cmd);
+#endif
 	cpp = info->cpp[0];
 
 	/* need to align pitch with crtc limits */
-- 
2.52.0

