From 21e6caf7041633c07471c7ce811c879573c6674a Mon Sep 17 00:00:00 2001
From: Kexy Biscuit <kexybiscuit@aosc.io>
Date: Thu, 6 Feb 2025 18:12:15 +0800
Subject: [PATCH 02/63] AOSCOS: loonggpu: remove driver date

Following upstream changes.

Fixes: cb2e1c2136f7 ("drm: remove driver date from struct drm_driver and all drivers")
Fixes: "chore: import 1.0.1-alpha-lnd25.5"
Signed-off-by: Kexy Biscuit <kexybiscuit@aosc.io>

[Xi Ruoyao: include linux/version.h.]

Signed-off-by: Xi Ruoyao <xry111@xry111.site>
---
 include/loonggpu_drv.h  | 3 +++
 loonggpu/loonggpu_drv.c | 2 ++
 2 files changed, 5 insertions(+)

diff --git a/include/loonggpu_drv.h b/include/loonggpu_drv.h
index ccd9a8a..b6ace8d 100644
--- a/include/loonggpu_drv.h
+++ b/include/loonggpu_drv.h
@@ -3,6 +3,7 @@
 
 #include <linux/firmware.h>
 #include <linux/platform_device.h>
+#include <linux/version.h>
 
 #include "loonggpu_shared.h"
 
@@ -10,7 +11,9 @@
 
 #define DRIVER_NAME		"loonggpu"
 #define DRIVER_DESC		"Loongson LGxx GPU Driver"
+#if (LINUX_VERSION_CODE < KERNEL_VERSION(6, 14, 0))
 #define DRIVER_DATE		"202501129.00"
+#endif
 
 long loonggpu_drm_ioctl(struct file *filp,
 		      unsigned int cmd, unsigned long arg);
diff --git a/loonggpu/loonggpu_drv.c b/loonggpu/loonggpu_drv.c
index 1cb7e9c..ae5d338 100644
--- a/loonggpu/loonggpu_drv.c
+++ b/loonggpu/loonggpu_drv.c
@@ -773,7 +773,9 @@ static struct drm_driver kms_driver = {
 
 	.name = DRIVER_NAME,
 	.desc = DRIVER_DESC,
+#if (LINUX_VERSION_CODE < KERNEL_VERSION(6, 14, 0))
 	.date = DRIVER_DATE,
+#endif
 	.major = KMS_DRIVER_MAJOR,
 	.minor = KMS_DRIVER_MINOR,
 	.patchlevel = KMS_DRIVER_PATCHLEVEL,
-- 
2.52.0

