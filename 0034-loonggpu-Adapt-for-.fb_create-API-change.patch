From 9d4810ea2718bedf650a29208a0307d3a203b82a Mon Sep 17 00:00:00 2001
From: Xi Ruoyao <xry111@xry111.site>
Date: Fri, 15 Aug 2025 20:12:24 +0800
Subject: [PATCH 34/63] loonggpu: Adapt for .fb_create API change

Link: https://git.kernel.org/torvalds/c/81112eaac559
Signed-off-by: Xi Ruoyao <xry111@xry111.site>
---
 include/loonggpu_display.h  | 9 +++++++++
 loonggpu/loonggpu_display.c | 1 +
 2 files changed, 10 insertions(+)

diff --git a/include/loonggpu_display.h b/include/loonggpu_display.h
index 6a62391..59ec5f7 100644
--- a/include/loonggpu_display.h
+++ b/include/loonggpu_display.h
@@ -1,10 +1,19 @@
 #ifndef __LOONGGPU_DISPLAY_H__
 #define __LOONGGPU_DISPLAY_H__
 
+#include <linux/version.h>
+
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(6, 17, 0)
+#define LOONGGPU_FB_CREATE_DRM_FORMAT_INFO const struct drm_format_info *info,
+#else
+#define LOONGGPU_FB_CREATE_DRM_FORMAT_INFO
+#endif
+
 uint32_t loonggpu_display_supported_domains(struct loonggpu_device *adev);
 struct drm_framebuffer *
 loonggpu_display_user_framebuffer_create(struct drm_device *dev,
 				       struct drm_file *file_priv,
+				       LOONGGPU_FB_CREATE_DRM_FORMAT_INFO
 				       const struct drm_mode_fb_cmd2 *mode_cmd);
 int loonggpu_display_crtc_page_flip_target(struct drm_crtc *crtc,
                                 struct drm_framebuffer *fb,
diff --git a/loonggpu/loonggpu_display.c b/loonggpu/loonggpu_display.c
index c24d9d1..5e93e34 100644
--- a/loonggpu/loonggpu_display.c
+++ b/loonggpu/loonggpu_display.c
@@ -305,6 +305,7 @@ int loonggpu_display_framebuffer_init(struct drm_device *dev,
 struct drm_framebuffer *
 loonggpu_display_user_framebuffer_create(struct drm_device *dev,
 				       struct drm_file *file_priv,
+				       LOONGGPU_FB_CREATE_DRM_FORMAT_INFO
 				       const struct drm_mode_fb_cmd2 *mode_cmd)
 {
 	struct drm_gem_object *obj;
-- 
2.52.0

