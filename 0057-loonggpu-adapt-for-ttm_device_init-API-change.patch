From 1ce69436ada6a01efb51a0d03378c026f7ac5ad5 Mon Sep 17 00:00:00 2001
From: Xi Ruoyao <xry111@xry111.site>
Date: Wed, 10 Dec 2025 14:58:46 +0800
Subject: [PATCH 57/63] loonggpu: adapt for ttm_device_init API change

Link: https://git.kernel.org/torvalds/c/77e19f8d3297
Signed-off-by: Xi Ruoyao <xry111@xry111.site>
---
 include/loonggpu_helper.h | 11 ++++++++++-
 1 file changed, 10 insertions(+), 1 deletion(-)

diff --git a/include/loonggpu_helper.h b/include/loonggpu_helper.h
index c6dd605..82cd586 100644
--- a/include/loonggpu_helper.h
+++ b/include/loonggpu_helper.h
@@ -103,7 +103,16 @@ static inline int lg_loonggpu_ttm_bo_device_init(struct loonggpu_device *adev,
 					#endif
 					     )
 {
-#if defined(LG_DRM_TTM_TTM_DEVICE_H_PRESENT)
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(6, 19, 0)
+	return ttm_device_init(&adev->mman.bdev,
+				driver, adev->dev,
+				adev->ddev->anon_inode->i_mapping,
+				adev->ddev->vma_offset_manager,
+				(adev->need_swiotlb ?
+				 TTM_ALLOCATION_POOL_USE_DMA_ALLOC : 0) |
+				(dma_addressing_limited(adev->dev) ?
+				 TTM_ALLOCATION_POOL_USE_DMA32 : 0));
+#elif defined(LG_DRM_TTM_TTM_DEVICE_H_PRESENT)
 	return ttm_device_init(&adev->mman.bdev,
 				driver, adev->dev,
 				adev->ddev->anon_inode->i_mapping,
-- 
2.52.0

