From 4204cca728db4886344052651fe471d8cadbcbf6 Mon Sep 17 00:00:00 2001
From: Xi Ruoyao <xry111@xry111.site>
Date: Fri, 15 Aug 2025 20:15:46 +0800
Subject: [PATCH 35/63] loonggpu: Adapt for drm_helper_mode_fill_fb_struct API
 change

Link: https://git.kernel.org/torvalds/c/a34cc7bf1034
Signed-off-by: Xi Ruoyao <xry111@xry111.site>
---
 loonggpu/loonggpu_display.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/loonggpu/loonggpu_display.c b/loonggpu/loonggpu_display.c
index 5e93e34..caa211c 100644
--- a/loonggpu/loonggpu_display.c
+++ b/loonggpu/loonggpu_display.c
@@ -293,7 +293,13 @@ int loonggpu_display_framebuffer_init(struct drm_device *dev,
 {
 	int ret;
 	rfb->base.obj[0] = obj;
+
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(6, 17, 0)
+	drm_helper_mode_fill_fb_struct(dev, &rfb->base, NULL, mode_cmd);
+#else
 	drm_helper_mode_fill_fb_struct(dev, &rfb->base, mode_cmd);
+#endif
+
 	ret = drm_framebuffer_init(dev, &rfb->base, &loonggpu_fb_funcs);
 	if (ret) {
 		rfb->base.obj[0] = NULL;
-- 
2.52.0

